<div class="col-lg-12">
  <div class="pb-2 mt-4 mb-2 border-bottom">
    <h1>Dashboard</h1>
  </div>
</div>
<div class="row">
  <div class="col-8">

    <div class="card mb-4">
      <%= link_to vms_path, method: :get, class: "dashboard-header-link" do %>
        <div class="card-header bg-primary text-white">
          <div class="btn-group">
            <h3><i class="fa fa-desktop fa-fw"></i> Active machines</h3>
          </div>
        </div>
      <% end %>
      <div class="card-body">
        <table data-toggle="table" class="table" id="vms_active">
          <thead>
          <tr>
            <th scope="col" data-sortable="true" class="bg-primary text-white rounded-left">Name</th>
            <th scope="col" data-sortable="true" class="bg-primary text-white">Project</th>
            <th scope="col" data-sortable="true" class="bg-primary text-white">Responsible</th>
          </tr>
          </thead>
          <tbody id="vms">
          <% @vms&.each do |vm| %>
            <tr>
              <td class="table-active">
                <%= render 'vms/vm_status', vm: vm %>
                <%= link_to vm.name,
                            {controller: :vms, action: 'show', id: vm.name},
                            method: :get, class: "btn btn-link"  %>
              </td>
              <td class="table-active">
                <% if vm.project.nil? %>
                  No project found!
                <% else %>
                  <%= link_to vm.project.name, vm.project %>
                <% end %>
              </td>
              <td class="table-active">
                <% if vm.responsible_users.empty? %>
                  No responsible users found!
                <% else %>
                  <ul class="list-unstyled">
                    <% vm.responsible_users.each do |user| %>
                      <li><%= link_to user.name, user %></li>
                    <% end %>
                  </ul>
                <% end %>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card mb-4">
      <%= link_to vms_path, method: :get, class: "dashboard-header-link" do %>
          <div class="card-header bg-primary text-white">
            <div class="btn-group">
              <h3><i class="fa fa-desktop fa-fw"></i> Archivable Machines</h3>
            </div>
          </div>
        <% end %>
      <div class="card-body">
          <table data-toggle="table" class="table" id="vms_to_be_archived">
            <thead>
            <tr>
              <th scope="col" data-sortable="true" class="bg-primary text-white rounded-left">Name</th>
              <th scope="col" data-sortable="true" class="bg-primary text-white">Project</th>
              <th scope="col" data-sortable="true" class="bg-primary text-white">Responsible</th>
            </tr>
            </thead>
            <tbody>
            <% @pending_archivation_vms&.each do |vm| %>
              <tr>

                <td class="table-active">
                  <div class="round <%= vm.powered_on? ? 'bg-success' : 'bg-warning mt-1'  %>"></div>
                  <%= link_to vm.name,
                              {controller: :vms, action: 'show', id: vm.name},
                              method: :get, class: "btn btn-link"  %>
                </td>
                <td class="table-active">
                  <% if vm.project.nil? %>
                    No project found!
                  <% else %>
                    <%= link_to vm.project.name, vm.project %>
                  <% end %>
                </td>
                <td class="table-active">
                  <% if vm.responsible_users.empty? %>
                    No responsible users found!
                  <% else %>
                    <ul class="list-unstyled">
                      <% vm.responsible_users.each do |user| %>
                        <li><%= link_to user.name, user %></li>
                      <% end %>
                    </ul>
                  <% end %>
                  <%if current_user.admin? && vm.archivable? %>
                    <%= link_to '',
                                {controller: :vms, action: 'archive_vm', id: vm.name},
                                method: :post, data: { confirm: 'Are you sure you want to archive this VM?' },
                                class: "btn-manage float-right checkmark" %>
                  <% end %>
                  <%= link_to '',
                              {controller: :vms, action: 'revive_vm', id: vm.name},
                              method: :post,
                              class: "btn-manage float-right cross" %>
                </td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
    </div>

    <!-- TODO: write revive code -->
    <div class="card mb-4">
      <%= link_to vms_path, method: :get, class: "dashboard-header-link" do %>
        <div class="card-header bg-primary text-white">
          <div class="btn-group">
            <h3><i class="fa fa-desktop fa-fw"></i> Revivable Machines</h3>
          </div>
        </div>
      <% end %>
      <div class="card-body">
        <table data-toggle="table" class="table" id="vms_to_be_archived">
          <thead>
          <tr>
            <th scope="col" data-sortable="true" class="bg-primary text-white rounded-left">Name</th>
            <th scope="col" data-sortable="true" class="bg-primary text-white">Project</th>
            <th scope="col" data-sortable="true" class="bg-primary text-white">Responsible</th>
          </tr>
          </thead>
          <tbody>
          <% @archivable&.each do |vm| %>
            <tr>

              <td class="table-active">
                <div class="round <%= vm.powered_on? ? 'bg-success' : 'bg-warning mt-1'  %>"></div>
                <%= link_to vm.name,
                            {controller: :vms, action: 'show', id: vm.name},
                            method: :get, class: "btn btn-link"  %>
              </td>
              <td class="table-active">
                <% if vm.project.nil? %>
                  No project found!
                <% else %>
                  <%= link_to vm.project.name, vm.project %>
                <% end %>
              </td>
              <td class="table-active">
                <% if vm.responsible_users.empty? %>
                  No responsible users found!
                <% else %>
                  <ul class="list-unstyled">
                    <% vm.responsible_users.each do |user| %>
                      <li><%= link_to user.name, user %></li>
                    <% end %>
                  </ul>
                <% end %>
                <%if current_user.admin? && vm.archivable? %>
                  <%= link_to '',
                              {controller: :vms, action: 'archive_vm', id: vm.name},
                              method: :post, data: { confirm: 'Are you sure you want to archive this VM?' },
                              class: "btn-manage float-right checkmark" %>
                <% end %>
                <%= link_to '',
                            {controller: :vms, action: 'revive_vm', id: vm.name},
                            method: :post,
                            class: "btn-manage float-right cross" %>
              </td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>




  <!-- end left column -->

  <div class="col-4">
    <div class="card mb-4">
      <%= link_to notifications_path, method: :get, class: "dashboard-header-link" do %>
        <div class="card-header bg-primary text-white">
          <div class="btn-group">
            <h3><i class="fa fa-bell"></i> Notifications</h3>
          </div>
        </div>
      <% end %>
      <div class="card-body">
        <%= render 'notifications/list' %>
      </div>
    </div>
  </div>
</div>
