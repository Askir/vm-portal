<h1>Users</h1>

<table class="table">
  <thead>
    <th><%= User.human_attribute_name('name') %></th>
    <th><%= User.human_attribute_name('email') %></th>
    <% if current_user.admin? %>
      <th><%= User.human_attribute_name('role') %></th>
    <% end %>
    <th><%= User.human_attribute_name('last_sign_in_at') %></th>
    <th></th>
  </thead>
  <tbody>
    <% @users.each do |user| %>
      <tr>
        <td><%= link_to user.name, user_path(user) %></td>
        <td><%= user.email %></td>
        <% if current_user.admin? %>
          <td>
            <div class="btn-group" role="group">
              <% User.roles.map(&:first).each do |role| %>
                <% if last_admin?(user) && current_user?(user) %>
                  <button class="btn btn-secondary disabled <%= 'active' if user.role == role %>"
                          id= "btn-<%= role %>-<%= user.id %>",
                  >
                    <%= role.capitalize %>
                  </button>
                <% else %>
                  <%= link_to role.capitalize,
                              update_role_user_path(user, role: role),
                              method: :patch,
                              id: "btn-#{role}-#{user.id}",
                              class: "btn btn-primary #{'active' if user.role == role}"
                  %>
                <% end %>
              <% end %>
            </div>
        <% end %>
        <td><%= user.current_sign_in_at %></td>
      </tr>
    <% end %>
  </tbody>
</table>
